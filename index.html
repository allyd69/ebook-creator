<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Ebook Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Playfair+Display:wght@400;500;600&family=Montserrat:wght@300;400;500;600&family=Lora:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Cormorant Garamond', Georgia, serif; background: #0A0A0F; min-height: 100vh; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0D0D0D; }
        ::-webkit-scrollbar-thumb { background: #D4AF37; border-radius: 4px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useCallback, useRef } = React;

        const PremiumEbookStudio = () => {
            const [activeTab, setActiveTab] = useState('cover');
            const [coverPrompt, setCoverPrompt] = useState('');
            const [generatedCover, setGeneratedCover] = useState(null);
            const [isGenerating, setIsGenerating] = useState(false);
            const [isExporting, setIsExporting] = useState(false);
            const [uploadedDoc, setUploadedDoc] = useState(null);
            const [documentContent, setDocumentContent] = useState('');
            const [selectedTemplate, setSelectedTemplate] = useState('luxury');
            const [ebookTitle, setEbookTitle] = useState('');
            const [ebookAuthor, setEbookAuthor] = useState('');
            const [chapters, setChapters] = useState([]);
            const [coverStyle, setCoverStyle] = useState('cinematic');
            const [generatedImages, setGeneratedImages] = useState([]);
            const [previewMode, setPreviewMode] = useState('fullbook');
            const [notification, setNotification] = useState(null);
            const [uploadedCoverImage, setUploadedCoverImage] = useState(null);
            const [imageOpacity, setImageOpacity] = useState(100);
            const [overlayOpacity, setOverlayOpacity] = useState(50);
            const [imageSource, setImageSource] = useState('none');
            
            const fileInputRef = useRef(null);
            const imageInputRef = useRef(null);

            // DISTINCT TEMPLATES with different styling
            const templates = [
                { 
                    id: 'luxury', 
                    name: 'Luxury Gold', 
                    desc: 'Elegant gold accents, serif fonts',
                    preview: { bg: '#1a1a2e', accent: '#D4AF37', text: '#FFFFFF', font: 'Playfair Display' },
                    coverBg: 'linear-gradient(145deg, #1a1a2e 0%, #0d0d1a 100%)',
                    pageBg: '#FAF8F5',
                    pageText: '#2A2A2A',
                    accentColor: '#D4AF37'
                },
                { 
                    id: 'modern', 
                    name: 'Modern Minimal', 
                    desc: 'Clean sans-serif, white space',
                    preview: { bg: '#FFFFFF', accent: '#000000', text: '#333333', font: 'Montserrat' },
                    coverBg: 'linear-gradient(145deg, #FFFFFF 0%, #F0F0F0 100%)',
                    pageBg: '#FFFFFF',
                    pageText: '#333333',
                    accentColor: '#000000'
                },
                { 
                    id: 'creative', 
                    name: 'Creative Coral', 
                    desc: 'Bold coral accents, playful',
                    preview: { bg: '#2D2D3A', accent: '#FF6B6B', text: '#FFFFFF', font: 'Montserrat' },
                    coverBg: 'linear-gradient(145deg, #2D2D3A 0%, #1a1a24 100%)',
                    pageBg: '#FFF9F9',
                    pageText: '#2D2D3A',
                    accentColor: '#FF6B6B'
                },
                { 
                    id: 'professional', 
                    name: 'Professional Navy', 
                    desc: 'Corporate, authoritative',
                    preview: { bg: '#1B2838', accent: '#4A90D9', text: '#FFFFFF', font: 'Georgia' },
                    coverBg: 'linear-gradient(145deg, #1B2838 0%, #0F1824 100%)',
                    pageBg: '#F8FAFC',
                    pageText: '#1B2838',
                    accentColor: '#4A90D9'
                },
                { 
                    id: 'romantic', 
                    name: 'Romantic Blush', 
                    desc: 'Soft pinks, delicate feel',
                    preview: { bg: '#FDF2F4', accent: '#C77D8E', text: '#5C4A4D', font: 'Lora' },
                    coverBg: 'linear-gradient(145deg, #5C4A4D 0%, #3D3133 100%)',
                    pageBg: '#FDF8F9',
                    pageText: '#5C4A4D',
                    accentColor: '#C77D8E'
                },
                { 
                    id: 'thriller', 
                    name: 'Thriller Dark', 
                    desc: 'High contrast, dramatic',
                    preview: { bg: '#0D0D0D', accent: '#C41E3A', text: '#FFFFFF', font: 'Georgia' },
                    coverBg: 'linear-gradient(145deg, #0D0D0D 0%, #000000 100%)',
                    pageBg: '#F5F5F5',
                    pageText: '#1A1A1A',
                    accentColor: '#C41E3A'
                },
            ];

            const coverStyles = [
                { id: 'cinematic', name: 'Cinematic', icon: 'üé¨' },
                { id: 'photorealistic', name: 'Photo', icon: 'üì∑' },
                { id: 'artistic', name: 'Artistic', icon: 'üé®' },
                { id: 'minimalist', name: 'Minimal', icon: '‚óªÔ∏è' },
                { id: 'vintage', name: 'Vintage', icon: 'üìú' },
                { id: 'fantasy', name: 'Fantasy', icon: '‚ú®' },
            ];

            const sampleContent = `Chapter 1: The Beginning

The morning light filtered through the ancient windows, casting long shadows across the weathered floorboards. She stood there, breath held, knowing that the next few moments would change everything.

Years of searching had led to this single moment. A lifetime of questions waiting to be answered. The room fell silent as she turned the page, her heart racing with anticipation.

"I never thought this day would come," she whispered to the empty room. But the room wasn't empty ‚Äî it was full of memories, of possibilities that stretched out before her like an endless horizon.

Chapter 2: The Journey

The road stretched endlessly before her, winding through valleys and over mountains that seemed to touch the sky. Each step brought her closer to the truth she had been seeking.

The villagers she met along the way spoke of legends and prophecies. They shared their bread and their stories, and she carried both with her as she continued on.

By the time she reached the ancient forest, the seasons had changed twice. This was where her journey would either end or truly begin.`;

            const getCurrentTemplate = () => templates.find(t => t.id === selectedTemplate) || templates[0];

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 4000);
            };

            const getCurrentCoverImage = () => {
                if (imageSource === 'upload' && uploadedCoverImage) return uploadedCoverImage.url;
                if (imageSource === 'ai' && generatedCover) return generatedCover.url;
                return null;
            };

            const handleFileUpload = useCallback((e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const content = event.target.result;
                    setUploadedDoc({ name: file.name, size: (file.size / 1024).toFixed(2) + ' KB' });
                    setDocumentContent(content);
                    
                    const lines = content.split('\n');
                    const detectedChapters = [];
                    let currentChapter = null;
                    let wordCount = 0;
                    
                    lines.forEach((line) => {
                        if (line.match(/^(Chapter|CHAPTER|Part|PART)\s*(\d+|[IVXLC]+)/i) || line.match(/^#{1,2}\s+/)) {
                            if (currentChapter) {
                                currentChapter.wordCount = wordCount;
                                detectedChapters.push(currentChapter);
                            }
                            currentChapter = { id: detectedChapters.length + 1, title: line.replace(/^#+\s*/, '').trim() || `Chapter ${detectedChapters.length + 1}` };
                            wordCount = 0;
                        } else {
                            wordCount += line.split(/\s+/).filter(w => w.length > 0).length;
                        }
                    });
                    if (currentChapter) { currentChapter.wordCount = wordCount; detectedChapters.push(currentChapter); }
                    if (detectedChapters.length === 0) {
                        detectedChapters.push({ id: 1, title: 'Full Document', wordCount: content.split(/\s+/).filter(w => w.length > 0).length });
                    }
                    setChapters(detectedChapters);
                    showNotification(`‚úì Uploaded: ${detectedChapters.length} section(s)`);
                };
                reader.readAsText(file);
            }, []);

            const handleImageUpload = useCallback((e) => {
                const file = e.target.files[0];
                if (!file || !file.type.startsWith('image/')) {
                    showNotification('Please upload an image file', 'error');
                    return;
                }
                const reader = new FileReader();
                reader.onload = (event) => {
                    setUploadedCoverImage({ url: event.target.result, name: file.name });
                    setImageSource('upload');
                    showNotification(`‚úì Image uploaded`);
                };
                reader.readAsDataURL(file);
            }, []);

            const generateCover = async () => {
                if (!coverPrompt.trim()) { showNotification('Enter a description', 'error'); return; }
                setIsGenerating(true);
                await new Promise(resolve => setTimeout(resolve, 2000));
                const seed = coverPrompt.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                const result = { url: `https://picsum.photos/seed/${seed}/600/900`, prompt: coverPrompt, timestamp: Date.now() };
                setGeneratedCover(result);
                setGeneratedImages(prev => [...prev, result]);
                setImageSource('ai');
                setIsGenerating(false);
                showNotification('‚úì Cover generated!');
            };

            // ========== FIXED PDF EXPORT ==========
            const exportPDF = async () => {
                setIsExporting(true);
                showNotification('Creating PDF...');
                
                try {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a5' });
                    const template = getCurrentTemplate();
                    const title = ebookTitle || 'Untitled Book';
                    const author = ebookAuthor || 'Unknown Author';
                    const content = documentContent || sampleContent;
                    
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();
                    const margin = 15;
                    const contentWidth = pageWidth - (margin * 2);

                    // Helper to convert hex to RGB
                    const hexToRgb = (hex) => {
                        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                        return result ? {
                            r: parseInt(result[1], 16),
                            g: parseInt(result[2], 16),
                            b: parseInt(result[3], 16)
                        } : { r: 0, g: 0, b: 0 };
                    };

                    const accentRgb = hexToRgb(template.accentColor);
                    const textRgb = hexToRgb(template.pageText);

                    // === COVER PAGE ===
                    pdf.setFillColor(26, 26, 46);
                    pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                    
                    // Gold accent bar
                    pdf.setFillColor(accentRgb.r, accentRgb.g, accentRgb.b);
                    pdf.rect(0, 0, pageWidth, 4, 'F');
                    
                    // Title
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(24);
                    pdf.setFont('helvetica', 'bold');
                    const titleLines = pdf.splitTextToSize(title, contentWidth);
                    pdf.text(titleLines, pageWidth / 2, pageHeight * 0.4, { align: 'center' });
                    
                    // Decorative line
                    pdf.setDrawColor(accentRgb.r, accentRgb.g, accentRgb.b);
                    pdf.setLineWidth(0.5);
                    pdf.line(pageWidth * 0.25, pageHeight * 0.52, pageWidth * 0.75, pageHeight * 0.52);
                    
                    // Author
                    pdf.setFontSize(14);
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(author, pageWidth / 2, pageHeight * 0.6, { align: 'center' });
                    
                    // Template name
                    pdf.setFontSize(8);
                    pdf.setTextColor(150, 150, 150);
                    pdf.text(template.name + ' Edition', pageWidth / 2, pageHeight * 0.9, { align: 'center' });

                    // === TITLE PAGE ===
                    pdf.addPage();
                    pdf.setFillColor(250, 248, 245);
                    pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                    
                    pdf.setTextColor(textRgb.r, textRgb.g, textRgb.b);
                    pdf.setFontSize(20);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(title, pageWidth / 2, pageHeight * 0.4, { align: 'center' });
                    
                    pdf.setFontSize(12);
                    pdf.setFont('helvetica', 'italic');
                    pdf.text('by', pageWidth / 2, pageHeight * 0.47, { align: 'center' });
                    
                    pdf.setFontSize(14);
                    pdf.setFont('helvetica', 'normal');
                    pdf.text(author, pageWidth / 2, pageHeight * 0.53, { align: 'center' });

                    // === CONTENT PAGES ===
                    const paragraphs = content.split(/\n\n+/).filter(p => p.trim());
                    let currentY = margin + 15;
                    let pageNum = 1;
                    
                    pdf.addPage();
                    pdf.setFillColor(250, 248, 245);
                    pdf.rect(0, 0, pageWidth, pageHeight, 'F');

                    paragraphs.forEach((para) => {
                        const trimmed = para.trim();
                        const isChapter = trimmed.match(/^(Chapter|CHAPTER|Part|PART)\s/i);
                        
                        if (isChapter) {
                            // Start new page for chapter if not at top
                            if (currentY > margin + 30) {
                                // Page number
                                pdf.setFontSize(9);
                                pdf.setTextColor(150, 150, 150);
                                pdf.text(String(pageNum), pageWidth / 2, pageHeight - 10, { align: 'center' });
                                pageNum++;
                                
                                pdf.addPage();
                                pdf.setFillColor(250, 248, 245);
                                pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                                currentY = margin + 15;
                            }
                            
                            // Chapter heading with accent color
                            pdf.setFontSize(16);
                            pdf.setFont('helvetica', 'bold');
                            pdf.setTextColor(accentRgb.r, accentRgb.g, accentRgb.b);
                            pdf.text(trimmed, pageWidth / 2, currentY, { align: 'center' });
                            currentY += 15;
                            
                        } else {
                            // Regular paragraph
                            pdf.setFontSize(11);
                            pdf.setFont('helvetica', 'normal');
                            pdf.setTextColor(textRgb.r, textRgb.g, textRgb.b);
                            
                            const lines = pdf.splitTextToSize(trimmed, contentWidth);
                            
                            for (let i = 0; i < lines.length; i++) {
                                if (currentY > pageHeight - margin - 15) {
                                    // Page number
                                    pdf.setFontSize(9);
                                    pdf.setTextColor(150, 150, 150);
                                    pdf.text(String(pageNum), pageWidth / 2, pageHeight - 10, { align: 'center' });
                                    pageNum++;
                                    
                                    pdf.addPage();
                                    pdf.setFillColor(250, 248, 245);
                                    pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                                    currentY = margin + 10;
                                    
                                    pdf.setFontSize(11);
                                    pdf.setTextColor(textRgb.r, textRgb.g, textRgb.b);
                                }
                                
                                pdf.text(lines[i], margin, currentY);
                                currentY += 5.5;
                            }
                            currentY += 3;
                        }
                    });

                    // Final page number
                    pdf.setFontSize(9);
                    pdf.setTextColor(150, 150, 150);
                    pdf.text(String(pageNum), pageWidth / 2, pageHeight - 10, { align: 'center' });

                    // Save
                    const filename = title.replace(/[^a-z0-9]/gi, '_') + '.pdf';
                    pdf.save(filename);
                    showNotification('‚úì PDF Downloaded!');
                    
                } catch (error) {
                    console.error('PDF Error:', error);
                    showNotification('PDF Error: ' + error.message, 'error');
                } finally {
                    setIsExporting(false);
                }
            };

            // ========== FIXED EPUB EXPORT (as HTML download) ==========
            const exportEPUB = async () => {
                setIsExporting(true);
                showNotification('Creating eBook HTML...');
                
                try {
                    const template = getCurrentTemplate();
                    const title = ebookTitle || 'Untitled Book';
                    const author = ebookAuthor || 'Unknown Author';
                    const content = documentContent || sampleContent;
                    
                    // Convert content to HTML
                    const paragraphs = content.split(/\n\n+/).filter(p => p.trim());
                    let htmlContent = '';
                    
                    paragraphs.forEach((para, idx) => {
                        const trimmed = para.trim();
                        if (trimmed.match(/^(Chapter|CHAPTER|Part|PART)\s/i)) {
                            htmlContent += `<h2 style="color: ${template.accentColor}; text-align: center; margin: 2em 0 1em; font-size: 1.5em;">${trimmed}</h2>\n`;
                        } else {
                            const isFirst = idx === 0 || paragraphs[idx - 1]?.match(/^(Chapter|CHAPTER|Part|PART)\s/i);
                            if (isFirst) {
                                const first = trimmed.charAt(0);
                                const rest = trimmed.slice(1);
                                htmlContent += `<p style="text-align: justify; text-indent: 0; margin: 0.8em 0;"><span style="float: left; font-size: 3em; line-height: 0.8; padding-right: 0.1em; color: ${template.accentColor};">${first}</span>${rest}</p>\n`;
                            } else {
                                htmlContent += `<p style="text-align: justify; text-indent: 1.5em; margin: 0.8em 0;">${trimmed}</p>\n`;
                            }
                        }
                    });

                    const fullHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 16px;
            line-height: 1.7;
            color: ${template.pageText};
            background: ${template.pageBg};
            max-width: 650px;
            margin: 0 auto;
            padding: 40px 30px;
        }
        .cover {
            text-align: center;
            padding: 80px 20px;
            background: linear-gradient(145deg, #1a1a2e 0%, #0d0d1a 100%);
            color: white;
            margin: -40px -30px 40px;
            border-top: 5px solid ${template.accentColor};
        }
        .cover h1 {
            font-size: 2.2em;
            margin-bottom: 20px;
            font-weight: normal;
        }
        .cover .divider {
            width: 100px;
            height: 2px;
            background: ${template.accentColor};
            margin: 20px auto;
        }
        .cover .author {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .cover .template {
            font-size: 0.8em;
            opacity: 0.6;
            margin-top: 40px;
        }
        .title-page {
            text-align: center;
            padding: 60px 20px;
            page-break-after: always;
            border-bottom: 1px solid #ddd;
            margin-bottom: 40px;
        }
        .title-page h1 {
            font-size: 2em;
            color: ${template.pageText};
            margin-bottom: 20px;
        }
        .title-page .author {
            font-size: 1.3em;
            color: #666;
        }
        .content { margin-top: 30px; }
        @media print {
            body { padding: 0; max-width: none; }
            .cover { page-break-after: always; }
        }
    </style>
</head>
<body>
    <div class="cover">
        <h1>${title}</h1>
        <div class="divider"></div>
        <p class="author">${author}</p>
        <p class="template">${template.name} Edition</p>
    </div>
    
    <div class="title-page">
        <h1>${title}</h1>
        <p style="margin: 10px 0;">by</p>
        <p class="author">${author}</p>
    </div>
    
    <div class="content">
        ${htmlContent}
    </div>
    
    <div style="text-align: center; margin-top: 60px; padding-top: 30px; border-top: 1px solid #ddd; color: #999; font-size: 0.9em;">
        ‚ùß The End ‚ùß
    </div>
</body>
</html>`;

                    // Download as HTML file
                    const blob = new Blob([fullHTML], { type: 'text/html;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = title.replace(/[^a-z0-9]/gi, '_') + '_ebook.html';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    showNotification('‚úì eBook HTML Downloaded!');
                    
                } catch (error) {
                    console.error('Export Error:', error);
                    showNotification('Export Error: ' + error.message, 'error');
                } finally {
                    setIsExporting(false);
                }
            };

            const downloadCoverImage = () => {
                const coverImage = getCurrentCoverImage();
                if (!coverImage) { showNotification('No cover image', 'error'); return; }
                
                const link = document.createElement('a');
                link.href = coverImage;
                link.download = (ebookTitle || 'cover').replace(/[^a-z0-9]/gi, '_') + '_cover.jpg';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showNotification('‚úì Cover downloaded!');
            };

            const exportTXT = () => {
                const content = documentContent || sampleContent;
                const title = ebookTitle || 'Untitled Book';
                const author = ebookAuthor || 'Unknown Author';
                const fullText = `${title}\nby ${author}\n\n${'‚ïê'.repeat(40)}\n\n${content}`;
                
                const blob = new Blob([fullText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = title.replace(/[^a-z0-9]/gi, '_') + '.txt';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                showNotification('‚úì TXT downloaded!');
            };

            const TabButton = ({ id, label, icon }) => (
                <button onClick={() => setActiveTab(id)} style={{
                    padding: '12px 16px', border: 'none',
                    background: activeTab === id ? 'linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%)' : 'transparent',
                    color: activeTab === id ? '#0D0D0D' : '#707070', fontSize: '11px', fontWeight: '600',
                    letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer',
                    fontFamily: 'inherit', borderRadius: '4px', transition: 'all 0.3s',
                }}>
                    <span style={{ marginRight: '5px' }}>{icon}</span>{label}
                </button>
            );

            const BookCover = ({ size = 'large' }) => {
                const coverImage = getCurrentCoverImage();
                const template = getCurrentTemplate();
                const isLarge = size === 'large';
                const w = isLarge ? 240 : 150;
                const h = isLarge ? 360 : 225;
                
                return (
                    <div style={{
                        width: w, height: h, borderRadius: '4px', position: 'relative', overflow: 'hidden', flexShrink: 0,
                        background: template.coverBg,
                        boxShadow: '12px 12px 40px rgba(0,0,0,0.5)',
                    }}>
                        {coverImage && (
                            <img src={coverImage} alt="Cover" style={{
                                position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', objectFit: 'cover', opacity: imageOpacity / 100,
                            }} />
                        )}
                        <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '5px', background: template.accentColor, zIndex: 10 }} />
                        <div style={{
                            position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, zIndex: 5, padding: isLarge ? '20px 15px' : '12px 10px',
                            background: coverImage ? `linear-gradient(180deg, rgba(0,0,0,${overlayOpacity/100}) 0%, transparent 40%, transparent 60%, rgba(0,0,0,${overlayOpacity/100 + 0.2}) 100%)` : 'transparent',
                            display: 'flex', flexDirection: 'column', justifyContent: 'space-between',
                        }}>
                            {(coverImage || ebookTitle) ? (
                                <>
                                    <div style={{ textAlign: 'center', marginTop: isLarge ? '25px' : '12px' }}>
                                        <div style={{ fontSize: isLarge ? '9px' : '7px', letterSpacing: '2px', color: template.accentColor, marginBottom: '8px', textTransform: 'uppercase', textShadow: '0 1px 5px rgba(0,0,0,0.8)' }}>{template.name}</div>
                                        <h3 style={{ fontSize: isLarge ? '18px' : '13px', fontWeight: '400', color: '#FFFFFF', lineHeight: '1.3', margin: 0, textShadow: '0 2px 10px rgba(0,0,0,0.9)', fontFamily: template.preview.font }}>{ebookTitle || 'Your Title'}</h3>
                                    </div>
                                    <div style={{ textAlign: 'center' }}>
                                        <div style={{ width: '30px', height: '1px', background: template.accentColor, margin: '0 auto 8px' }} />
                                        <p style={{ fontSize: isLarge ? '11px' : '8px', letterSpacing: '1px', color: '#E0E0E0', margin: 0, textTransform: 'uppercase', textShadow: '0 1px 5px rgba(0,0,0,0.8)' }}>{ebookAuthor || 'Author'}</p>
                                    </div>
                                </>
                            ) : (
                                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', color: '#505060' }}>
                                    <div style={{ fontSize: isLarge ? '36px' : '24px', marginBottom: '10px', opacity: 0.5, animation: 'float 3s ease-in-out infinite' }}>üìö</div>
                                    <p style={{ fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', textAlign: 'center' }}>Add image</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const template = getCurrentTemplate();

            return (
                <div style={{ minHeight: '100vh', background: 'linear-gradient(180deg, #0A0A0F 0%, #151520 50%, #0D0D12 100%)', fontFamily: "'Cormorant Garamond', Georgia, serif", color: '#E8E8E8' }}>
                    
                    {notification && (
                        <div style={{
                            position: 'fixed', top: '15px', right: '15px', left: '15px', maxWidth: '350px', marginLeft: 'auto',
                            padding: '14px 18px', zIndex: 1000, animation: 'fadeIn 0.3s ease', borderRadius: '6px',
                            background: notification.type === 'error' ? '#8B0000' : 'linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%)',
                            color: notification.type === 'error' ? '#FFF' : '#0D0D0D', fontWeight: '600', fontSize: '13px',
                            boxShadow: '0 8px 25px rgba(0,0,0,0.4)',
                        }}>{notification.message}</div>
                    )}

                    {isExporting && (
                        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.8)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 999 }}>
                            <div style={{ background: 'rgba(20, 20, 28, 0.95)', padding: '30px 45px', borderRadius: '8px', textAlign: 'center', border: '1px solid rgba(212, 175, 55, 0.3)' }}>
                                <div style={{ width: '40px', height: '40px', border: '3px solid rgba(212, 175, 55, 0.3)', borderTop: '3px solid #D4AF37', borderRadius: '50%', animation: 'spin 1s linear infinite', margin: '0 auto 15px' }} />
                                <p style={{ color: '#D4AF37', fontSize: '13px', letterSpacing: '2px' }}>CREATING FILE...</p>
                            </div>
                        </div>
                    )}

                    <header style={{ padding: '18px 15px', borderBottom: '1px solid rgba(212, 175, 55, 0.15)', background: 'rgba(10, 10, 15, 0.95)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', maxWidth: '1200px', margin: '0 auto', flexWrap: 'wrap', gap: '10px' }}>
                            <div>
                                <h1 style={{ fontSize: 'clamp(15px, 4vw, 20px)', fontWeight: '300', letterSpacing: '3px', textTransform: 'uppercase', background: 'linear-gradient(135deg, #D4AF37 0%, #F4E5B2 50%, #D4AF37 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', margin: 0 }}>Premium Ebook Studio</h1>
                            </div>
                            <div style={{ display: 'flex', gap: '8px' }}>
                                <button onClick={exportPDF} disabled={isExporting} style={{ padding: '10px 14px', background: 'linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%)', border: 'none', borderRadius: '4px', color: '#0D0D0D', fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer', fontFamily: 'inherit', fontWeight: '600' }}>üìÑ PDF</button>
                                <button onClick={exportEPUB} disabled={isExporting} style={{ padding: '10px 14px', background: 'transparent', border: '1px solid rgba(212, 175, 55, 0.5)', borderRadius: '4px', color: '#D4AF37', fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer', fontFamily: 'inherit' }}>üìö HTML</button>
                            </div>
                        </div>
                    </header>

                    <nav style={{ display: 'flex', justifyContent: 'center', gap: '3px', padding: '12px 8px', background: 'rgba(15, 15, 20, 0.6)', borderBottom: '1px solid rgba(212, 175, 55, 0.1)', flexWrap: 'wrap' }}>
                        <TabButton id="cover" label="Cover" icon="üìñ" />
                        <TabButton id="upload" label="Text" icon="üì§" />
                        <TabButton id="template" label="Style" icon="‚ú®" />
                        <TabButton id="preview" label="Preview" icon="üëÅ" />
                        <TabButton id="export" label="Export" icon="üíæ" />
                    </nav>

                    <main style={{ maxWidth: '1200px', margin: '0 auto', padding: '20px 12px' }}>
                        
                        {/* COVER TAB */}
                        {activeTab === 'cover' && (
                            <div style={{ animation: 'fadeIn 0.4s ease', display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '20px' }}>
                                <div>
                                    {/* Upload Image */}
                                    <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '2px solid rgba(212, 175, 55, 0.4)', borderRadius: '8px', padding: '18px', marginBottom: '15px' }}>
                                        <h2 style={{ fontSize: '14px', letterSpacing: '2px', textTransform: 'uppercase', color: '#D4AF37', marginBottom: '12px' }}>üì∑ Upload Image</h2>
                                        <input ref={imageInputRef} type="file" accept="image/*" onChange={handleImageUpload} style={{ display: 'none' }} />
                                        <div onClick={() => imageInputRef.current?.click()} style={{ border: '2px dashed rgba(212, 175, 55, 0.4)', borderRadius: '6px', padding: '18px 12px', textAlign: 'center', cursor: 'pointer' }}>
                                            <div style={{ fontSize: '26px', marginBottom: '5px' }}>üñºÔ∏è</div>
                                            <p style={{ color: '#D4AF37', fontSize: '11px' }}>Click to upload</p>
                                            <p style={{ color: '#404040', fontSize: '9px' }}>JPG, PNG, GIF, WebP</p>
                                        </div>
                                        {uploadedCoverImage && (
                                            <div style={{ marginTop: '10px', padding: '8px', background: 'rgba(212, 175, 55, 0.1)', borderRadius: '4px', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                                <span style={{ color: '#D4AF37', fontSize: '11px' }}>‚úì {uploadedCoverImage.name?.substring(0, 20)}</span>
                                                <button onClick={() => setImageSource('upload')} style={{ padding: '4px 10px', background: imageSource === 'upload' ? '#D4AF37' : 'transparent', border: '1px solid #D4AF37', borderRadius: '3px', color: imageSource === 'upload' ? '#000' : '#D4AF37', fontSize: '8px', cursor: 'pointer' }}>{imageSource === 'upload' ? '‚úì' : 'Use'}</button>
                                            </div>
                                        )}
                                    </div>

                                    {/* AI Generate */}
                                    <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.2)', borderRadius: '8px', padding: '18px', marginBottom: '15px' }}>
                                        <h2 style={{ fontSize: '14px', letterSpacing: '2px', textTransform: 'uppercase', color: '#D4AF37', marginBottom: '12px' }}>üé¨ AI Generate</h2>
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '5px', marginBottom: '10px' }}>
                                            {coverStyles.map(s => (
                                                <button key={s.id} onClick={() => setCoverStyle(s.id)} style={{ padding: '8px 4px', background: coverStyle === s.id ? 'rgba(212, 175, 55, 0.2)' : 'rgba(30, 30, 40, 0.5)', border: coverStyle === s.id ? '1px solid #D4AF37' : '1px solid rgba(50, 50, 70, 0.3)', borderRadius: '4px', color: coverStyle === s.id ? '#D4AF37' : '#606060', fontSize: '9px', cursor: 'pointer', fontFamily: 'inherit' }}>
                                                    <div style={{ fontSize: '14px' }}>{s.icon}</div>{s.name}
                                                </button>
                                            ))}
                                        </div>
                                        <textarea value={coverPrompt} onChange={(e) => setCoverPrompt(e.target.value)} placeholder="Describe your cover..." rows={2} style={{ width: '100%', padding: '10px', background: 'rgba(20, 20, 30, 0.8)', border: '1px solid rgba(60, 60, 80, 0.3)', borderRadius: '4px', color: '#E8E8E8', fontSize: '12px', fontFamily: 'inherit', outline: 'none', resize: 'none', boxSizing: 'border-box', marginBottom: '10px' }} />
                                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px', marginBottom: '10px' }}>
                                            {['Sunset mountains', 'Ocean waves', 'City lights'].map(p => (
                                                <button key={p} onClick={() => setCoverPrompt(p)} style={{ padding: '4px 8px', background: 'rgba(30, 30, 40, 0.6)', border: '1px solid rgba(50, 50, 70, 0.3)', borderRadius: '10px', color: '#505050', fontSize: '8px', cursor: 'pointer', fontFamily: 'inherit' }}>{p}</button>
                                            ))}
                                        </div>
                                        <button onClick={generateCover} disabled={isGenerating || !coverPrompt.trim()} style={{ width: '100%', padding: '11px', background: isGenerating ? '#444' : 'linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%)', border: 'none', borderRadius: '4px', color: '#0D0D0D', fontSize: '11px', letterSpacing: '1px', textTransform: 'uppercase', cursor: isGenerating ? 'wait' : 'pointer', fontFamily: 'inherit', fontWeight: '600', opacity: !coverPrompt.trim() ? 0.5 : 1 }}>{isGenerating ? '‚è≥ Generating...' : '‚ú¶ Generate'}</button>
                                        {generatedImages.length > 0 && (
                                            <div style={{ marginTop: '10px', display: 'flex', gap: '5px', overflowX: 'auto' }}>
                                                {generatedImages.slice(-4).map((img, i) => (
                                                    <div key={i} onClick={() => { setGeneratedCover(img); setImageSource('ai'); }} style={{ width: '38px', height: '55px', background: `url(${img.url}) center/cover`, borderRadius: '3px', cursor: 'pointer', border: generatedCover?.timestamp === img.timestamp && imageSource === 'ai' ? '2px solid #D4AF37' : '2px solid transparent', flexShrink: 0 }} />
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Controls */}
                                    <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.2)', borderRadius: '8px', padding: '18px' }}>
                                        <h2 style={{ fontSize: '14px', letterSpacing: '2px', textTransform: 'uppercase', color: '#D4AF37', marginBottom: '12px' }}>üéöÔ∏è Controls</h2>
                                        <div style={{ marginBottom: '12px' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}><span style={{ fontSize: '10px', color: '#707070' }}>Image Opacity</span><span style={{ fontSize: '10px', color: '#D4AF37' }}>{imageOpacity}%</span></div>
                                            <input type="range" min="0" max="100" value={imageOpacity} onChange={(e) => setImageOpacity(Number(e.target.value))} style={{ width: '100%', accentColor: '#D4AF37' }} />
                                        </div>
                                        <div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}><span style={{ fontSize: '10px', color: '#707070' }}>Text Overlay</span><span style={{ fontSize: '10px', color: '#D4AF37' }}>{overlayOpacity}%</span></div>
                                            <input type="range" min="0" max="100" value={overlayOpacity} onChange={(e) => setOverlayOpacity(Number(e.target.value))} style={{ width: '100%', accentColor: '#D4AF37' }} />
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    {/* Book Details */}
                                    <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.2)', borderRadius: '8px', padding: '18px', marginBottom: '15px' }}>
                                        <h2 style={{ fontSize: '14px', letterSpacing: '2px', textTransform: 'uppercase', color: '#D4AF37', marginBottom: '12px' }}>üìù Details</h2>
                                        <div style={{ marginBottom: '10px' }}>
                                            <label style={{ display: 'block', fontSize: '9px', color: '#505050', marginBottom: '4px', textTransform: 'uppercase', letterSpacing: '1px' }}>Title</label>
                                            <input type="text" value={ebookTitle} onChange={(e) => setEbookTitle(e.target.value)} placeholder="Book title..." style={{ width: '100%', padding: '10px', background: 'rgba(20, 20, 30, 0.8)', border: '1px solid rgba(60, 60, 80, 0.3)', borderRadius: '4px', color: '#E8E8E8', fontSize: '13px', fontFamily: 'inherit', outline: 'none', boxSizing: 'border-box' }} />
                                        </div>
                                        <div>
                                            <label style={{ display: 'block', fontSize: '9px', color: '#505050', marginBottom: '4px', textTransform: 'uppercase', letterSpacing: '1px' }}>Author</label>
                                            <input type="text" value={ebookAuthor} onChange={(e) => setEbookAuthor(e.target.value)} placeholder="Your name..." style={{ width: '100%', padding: '10px', background: 'rgba(20, 20, 30, 0.8)', border: '1px solid rgba(60, 60, 80, 0.3)', borderRadius: '4px', color: '#E8E8E8', fontSize: '13px', fontFamily: 'inherit', outline: 'none', boxSizing: 'border-box' }} />
                                        </div>
                                    </div>

                                    {/* Preview */}
                                    <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.2)', borderRadius: '8px', padding: '18px', display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                                        <h2 style={{ fontSize: '14px', letterSpacing: '2px', textTransform: 'uppercase', color: '#D4AF37', marginBottom: '15px', alignSelf: 'flex-start' }}>üëÅÔ∏è Preview</h2>
                                        <BookCover size="large" />
                                        <div style={{ marginTop: '12px', padding: '5px 12px', background: 'rgba(212, 175, 55, 0.1)', borderRadius: '10px', fontSize: '9px', color: '#D4AF37' }}>
                                            {imageSource === 'upload' ? 'üì∑ Uploaded' : imageSource === 'ai' ? 'üé¨ AI' : 'üìö None'}
                                        </div>
                                        {getCurrentCoverImage() && (
                                            <button onClick={downloadCoverImage} style={{ marginTop: '10px', padding: '7px 14px', background: 'transparent', border: '1px solid rgba(212, 175, 55, 0.4)', borderRadius: '4px', color: '#D4AF37', fontSize: '9px', cursor: 'pointer', fontFamily: 'inherit' }}>‚¨á Download</button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* UPLOAD TAB */}
                        {activeTab === 'upload' && (
                            <div style={{ animation: 'fadeIn 0.4s ease', display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '20px' }}>
                                <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.2)', borderRadius: '8px', padding: '18px' }}>
                                    <h2 style={{ fontSize: '14px', letterSpacing: '2px', textTransform: 'uppercase', color: '#D4AF37', marginBottom: '15px' }}>üì§ Upload Manuscript</h2>
                                    <input ref={fileInputRef} type="file" accept=".txt,.md" onChange={handleFileUpload} style={{ display: 'none' }} />
                                    <div onClick={() => fileInputRef.current?.click()} style={{ border: '2px dashed rgba(212, 175, 55, 0.4)', borderRadius: '6px', padding: '30px 15px', textAlign: 'center', cursor: 'pointer' }}>
                                        <div style={{ fontSize: '32px', marginBottom: '8px' }}>üìÑ</div>
                                        <p style={{ color: '#D4AF37', fontSize: '12px', marginBottom: '4px' }}>Click to upload</p>
                                        <p style={{ color: '#404040', fontSize: '10px' }}>TXT or Markdown</p>
                                    </div>
                                    {uploadedDoc && (
                                        <div style={{ marginTop: '12px', padding: '10px', background: 'rgba(212, 175, 55, 0.1)', borderRadius: '4px' }}>
                                            <p style={{ color: '#D4AF37', fontSize: '12px' }}>‚úì {uploadedDoc.name}</p>
                                            <p style={{ color: '#505050', fontSize: '10px' }}>{uploadedDoc.size}</p>
                                        </div>
                                    )}
                                </div>
                                <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.2)', borderRadius: '8px', padding: '18px' }}>
                                    <h2 style={{ fontSize: '14px', letterSpacing: '2px', textTransform: 'uppercase', color: '#D4AF37', marginBottom: '15px' }}>üìë Structure</h2>
                                    {chapters.length > 0 ? (
                                        <div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '10px', padding: '8px', background: 'rgba(212, 175, 55, 0.1)', borderRadius: '4px' }}>
                                                <span style={{ color: '#D4AF37', fontSize: '11px' }}>{chapters.length} sections</span>
                                                <span style={{ color: '#505050', fontSize: '11px' }}>{chapters.reduce((a, c) => a + (c.wordCount || 0), 0).toLocaleString()} words</span>
                                            </div>
                                            <div style={{ maxHeight: '200px', overflowY: 'auto' }}>
                                                {chapters.map(ch => (
                                                    <div key={ch.id} style={{ padding: '8px', background: 'rgba(25, 25, 35, 0.6)', borderRadius: '4px', marginBottom: '4px', display: 'flex', justifyContent: 'space-between' }}>
                                                        <span style={{ color: '#B0B0B0', fontSize: '11px' }}>{ch.title}</span>
                                                        <span style={{ color: '#404040', fontSize: '9px' }}>{(ch.wordCount || 0).toLocaleString()}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        <div style={{ textAlign: 'center', padding: '30px', color: '#353540' }}>
                                            <div style={{ fontSize: '28px', marginBottom: '8px', opacity: 0.5 }}>üìë</div>
                                            <p style={{ fontSize: '11px' }}>Upload to see structure</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* TEMPLATES TAB - NOW WITH DISTINCT PREVIEWS */}
                        {activeTab === 'template' && (
                            <div style={{ animation: 'fadeIn 0.4s ease' }}>
                                <h2 style={{ fontSize: '15px', letterSpacing: '2px', textTransform: 'uppercase', color: '#D4AF37', marginBottom: '20px', textAlign: 'center' }}>Select Style Template</h2>
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(180px, 1fr))', gap: '15px' }}>
                                    {templates.map(t => (
                                        <div key={t.id} onClick={() => { setSelectedTemplate(t.id); showNotification(`‚úì ${t.name} selected`); }} style={{
                                            background: selectedTemplate === t.id ? 'rgba(212, 175, 55, 0.15)' : 'rgba(20, 20, 28, 0.9)',
                                            border: selectedTemplate === t.id ? '2px solid #D4AF37' : '1px solid rgba(50, 50, 70, 0.2)',
                                            borderRadius: '8px', padding: '15px', cursor: 'pointer', position: 'relative',
                                        }}>
                                            {selectedTemplate === t.id && <div style={{ position: 'absolute', top: '8px', right: '8px', width: '18px', height: '18px', background: '#D4AF37', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#000', fontSize: '10px', fontWeight: 'bold' }}>‚úì</div>}
                                            
                                            {/* DISTINCT VISUAL PREVIEW */}
                                            <div style={{ display: 'flex', gap: '8px', marginBottom: '12px' }}>
                                                {/* Mini cover preview */}
                                                <div style={{ width: '45px', height: '65px', background: t.coverBg, borderRadius: '3px', position: 'relative', overflow: 'hidden', boxShadow: '3px 3px 10px rgba(0,0,0,0.3)' }}>
                                                    <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: t.accentColor }} />
                                                    <div style={{ position: 'absolute', bottom: '8px', left: '4px', right: '4px', height: '2px', background: t.accentColor, opacity: 0.5 }} />
                                                </div>
                                                {/* Mini page preview */}
                                                <div style={{ width: '45px', height: '65px', background: t.pageBg, borderRadius: '3px', padding: '6px 4px', boxShadow: '2px 2px 8px rgba(0,0,0,0.2)' }}>
                                                    <div style={{ width: '100%', height: '3px', background: t.accentColor, marginBottom: '4px', borderRadius: '1px' }} />
                                                    <div style={{ width: '100%', height: '2px', background: t.pageText, opacity: 0.3, marginBottom: '2px' }} />
                                                    <div style={{ width: '80%', height: '2px', background: t.pageText, opacity: 0.3, marginBottom: '2px' }} />
                                                    <div style={{ width: '90%', height: '2px', background: t.pageText, opacity: 0.3, marginBottom: '2px' }} />
                                                    <div style={{ width: '70%', height: '2px', background: t.pageText, opacity: 0.3 }} />
                                                </div>
                                            </div>
                                            
                                            {/* Color swatches */}
                                            <div style={{ display: 'flex', gap: '4px', marginBottom: '10px' }}>
                                                <div style={{ width: '18px', height: '18px', background: t.preview.bg, borderRadius: '3px', border: '1px solid rgba(255,255,255,0.1)' }} />
                                                <div style={{ width: '18px', height: '18px', background: t.accentColor, borderRadius: '3px' }} />
                                                <div style={{ width: '18px', height: '18px', background: t.pageBg, borderRadius: '3px', border: '1px solid rgba(0,0,0,0.1)' }} />
                                            </div>
                                            
                                            <h3 style={{ fontSize: '13px', color: '#D0D0D0', marginBottom: '3px' }}>{t.name}</h3>
                                            <p style={{ fontSize: '10px', color: '#505050' }}>{t.desc}</p>
                                        </div>
                                    ))}
                                </div>
                                
                                {/* Current template preview */}
                                <div style={{ marginTop: '25px', padding: '20px', background: 'rgba(20, 20, 28, 0.9)', borderRadius: '8px', border: '1px solid rgba(212, 175, 55, 0.2)' }}>
                                    <h3 style={{ fontSize: '12px', color: '#D4AF37', marginBottom: '15px', letterSpacing: '1px', textTransform: 'uppercase' }}>Current: {template.name}</h3>
                                    <div style={{ display: 'flex', gap: '20px', justifyContent: 'center', flexWrap: 'wrap' }}>
                                        <BookCover size="small" />
                                        <div style={{ width: '150px', height: '225px', background: template.pageBg, borderRadius: '4px', padding: '15px 12px', boxShadow: '8px 8px 25px rgba(0,0,0,0.3)', fontFamily: 'Georgia, serif' }}>
                                            <div style={{ fontSize: '10px', color: template.accentColor, fontWeight: 'bold', marginBottom: '8px' }}>Chapter 1</div>
                                            <p style={{ fontSize: '8px', color: template.pageText, lineHeight: '1.5' }}>
                                                <span style={{ float: 'left', fontSize: '18px', color: template.accentColor, paddingRight: '2px', lineHeight: '0.8' }}>T</span>
                                                he morning light filtered through the windows...
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* PREVIEW TAB */}
                        {activeTab === 'preview' && (
                            <div style={{ animation: 'fadeIn 0.4s ease' }}>
                                <div style={{ display: 'flex', justifyContent: 'center', marginBottom: '20px' }}>
                                    <div style={{ display: 'flex', gap: '4px', background: 'rgba(20, 20, 28, 0.8)', padding: '5px', borderRadius: '6px' }}>
                                        {['cover', 'interior', 'fullbook'].map(m => (
                                            <button key={m} onClick={() => setPreviewMode(m)} style={{ padding: '8px 16px', background: previewMode === m ? '#D4AF37' : 'transparent', border: 'none', borderRadius: '4px', color: previewMode === m ? '#000' : '#606060', fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer', fontFamily: 'inherit', fontWeight: previewMode === m ? '600' : '400' }}>{m === 'fullbook' ? 'Full' : m}</button>
                                        ))}
                                    </div>
                                </div>
                                
                                {previewMode === 'cover' && <div style={{ display: 'flex', justifyContent: 'center' }}><BookCover size="large" /></div>}
                                
                                {previewMode === 'interior' && (
                                    <div style={{ display: 'flex', justifyContent: 'center' }}>
                                        <div style={{ width: '100%', maxWidth: '500px', background: template.pageBg, borderRadius: '4px', padding: '30px 35px', boxShadow: '15px 15px 45px rgba(0,0,0,0.4)', fontFamily: 'Georgia, serif' }}>
                                            <p style={{ fontSize: '8px', color: '#888', textAlign: 'center', marginBottom: '18px' }}>12</p>
                                            <p style={{ fontSize: '12px', color: template.pageText, lineHeight: '1.8', textAlign: 'justify' }}>
                                                <span style={{ float: 'left', fontSize: '40px', lineHeight: '0.8', paddingRight: '6px', color: template.accentColor }}>T</span>
                                                he morning light filtered through the ancient windows, casting long shadows across the weathered floorboards. She stood there, breath held, knowing that the next few moments would change everything.
                                            </p>
                                            <p style={{ fontSize: '12px', color: template.pageText, lineHeight: '1.8', textAlign: 'justify', marginTop: '14px' }}>
                                                Years of searching had led to this single moment. A lifetime of questions waiting to be answered.
                                            </p>
                                            <div style={{ textAlign: 'center', marginTop: '25px', color: template.accentColor, fontSize: '14px' }}>‚ùß</div>
                                        </div>
                                    </div>
                                )}
                                
                                {previewMode === 'fullbook' && (
                                    <div style={{ display: 'flex', justifyContent: 'center', gap: '15px', flexWrap: 'wrap' }}>
                                        <div style={{ textAlign: 'center' }}><p style={{ color: '#505050', fontSize: '9px', marginBottom: '8px', textTransform: 'uppercase' }}>Cover</p><BookCover size="small" /></div>
                                        <div style={{ textAlign: 'center' }}>
                                            <p style={{ color: '#505050', fontSize: '9px', marginBottom: '8px', textTransform: 'uppercase' }}>Interior</p>
                                            <div style={{ display: 'flex', boxShadow: '10px 10px 30px rgba(0,0,0,0.4)', borderRadius: '3px', overflow: 'hidden' }}>
                                                <div style={{ width: '130px', height: '180px', background: template.pageBg, padding: '15px 10px', borderRight: `1px solid ${template.pageText}22`, fontFamily: 'Georgia, serif' }}>
                                                    <p style={{ fontSize: '6px', color: '#888', textAlign: 'center', marginBottom: '8px' }}>12</p>
                                                    <p style={{ fontSize: '8px', color: template.pageText, lineHeight: '1.5' }}>
                                                        <span style={{ float: 'left', fontSize: '16px', color: template.accentColor, paddingRight: '2px', lineHeight: '0.8' }}>T</span>
                                                        he morning light filtered through...
                                                    </p>
                                                </div>
                                                <div style={{ width: '130px', height: '180px', background: template.pageBg, padding: '15px 10px', fontFamily: 'Georgia, serif' }}>
                                                    <p style={{ fontSize: '8px', color: template.pageText, lineHeight: '1.5' }}>Years of searching had led to this moment.</p>
                                                    <div style={{ textAlign: 'center', marginTop: '15px', color: template.accentColor, fontSize: '8px' }}>‚ùß</div>
                                                    <p style={{ fontSize: '6px', color: '#888', textAlign: 'center', marginTop: '30px' }}>13</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* EXPORT TAB */}
                        {activeTab === 'export' && (
                            <div style={{ animation: 'fadeIn 0.4s ease' }}>
                                <h2 style={{ fontSize: '15px', letterSpacing: '2px', textTransform: 'uppercase', color: '#D4AF37', marginBottom: '20px', textAlign: 'center' }}>üíæ Export Your Ebook</h2>
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', maxWidth: '800px', margin: '0 auto' }}>
                                    <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.3)', borderRadius: '8px', padding: '18px', textAlign: 'center' }}>
                                        <div style={{ fontSize: '32px', marginBottom: '8px' }}>üìÑ</div>
                                        <h3 style={{ color: '#D4AF37', fontSize: '13px', marginBottom: '4px' }}>PDF</h3>
                                        <p style={{ color: '#505050', fontSize: '10px', marginBottom: '12px' }}>Print-ready with cover & formatting</p>
                                        <button onClick={exportPDF} disabled={isExporting} style={{ width: '100%', padding: '10px', background: 'linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%)', border: 'none', borderRadius: '4px', color: '#000', fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer', fontWeight: '600' }}>‚¨á Download PDF</button>
                                    </div>
                                    <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.3)', borderRadius: '8px', padding: '18px', textAlign: 'center' }}>
                                        <div style={{ fontSize: '32px', marginBottom: '8px' }}>üìö</div>
                                        <h3 style={{ color: '#D4AF37', fontSize: '13px', marginBottom: '4px' }}>HTML eBook</h3>
                                        <p style={{ color: '#505050', fontSize: '10px', marginBottom: '12px' }}>Styled HTML for browsers & conversion</p>
                                        <button onClick={exportEPUB} disabled={isExporting} style={{ width: '100%', padding: '10px', background: 'linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%)', border: 'none', borderRadius: '4px', color: '#000', fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer', fontWeight: '600' }}>‚¨á Download HTML</button>
                                    </div>
                                    <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.3)', borderRadius: '8px', padding: '18px', textAlign: 'center' }}>
                                        <div style={{ fontSize: '32px', marginBottom: '8px' }}>üñºÔ∏è</div>
                                        <h3 style={{ color: '#D4AF37', fontSize: '13px', marginBottom: '4px' }}>Cover Image</h3>
                                        <p style={{ color: '#505050', fontSize: '10px', marginBottom: '12px' }}>Download your cover</p>
                                        <button onClick={downloadCoverImage} disabled={!getCurrentCoverImage()} style={{ width: '100%', padding: '10px', background: getCurrentCoverImage() ? 'linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%)' : '#333', border: 'none', borderRadius: '4px', color: getCurrentCoverImage() ? '#000' : '#555', fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: getCurrentCoverImage() ? 'pointer' : 'not-allowed', fontWeight: '600' }}>{getCurrentCoverImage() ? '‚¨á Download' : 'No Cover'}</button>
                                    </div>
                                    <div style={{ background: 'rgba(20, 20, 28, 0.9)', border: '1px solid rgba(212, 175, 55, 0.3)', borderRadius: '8px', padding: '18px', textAlign: 'center' }}>
                                        <div style={{ fontSize: '32px', marginBottom: '8px' }}>üìù</div>
                                        <h3 style={{ color: '#D4AF37', fontSize: '13px', marginBottom: '4px' }}>Plain Text</h3>
                                        <p style={{ color: '#505050', fontSize: '10px', marginBottom: '12px' }}>Simple text backup</p>
                                        <button onClick={exportTXT} style={{ width: '100%', padding: '10px', background: 'transparent', border: '1px solid #D4AF37', borderRadius: '4px', color: '#D4AF37', fontSize: '10px', letterSpacing: '1px', textTransform: 'uppercase', cursor: 'pointer' }}>‚¨á Download TXT</button>
                                    </div>
                                </div>
                                <div style={{ marginTop: '20px', padding: '15px', background: 'rgba(212, 175, 55, 0.05)', border: '1px solid rgba(212, 175, 55, 0.2)', borderRadius: '8px', maxWidth: '600px', margin: '20px auto 0' }}>
                                    <p style={{ color: '#707070', fontSize: '11px', lineHeight: '1.6' }}>üí° <strong>Tip:</strong> Fill in Title & Author in Cover tab for proper metadata. Files download to your Downloads folder.</p>
                                </div>
                            </div>
                        )}
                    </main>

                    <footer style={{ padding: '18px', borderTop: '1px solid rgba(212, 175, 55, 0.1)', textAlign: 'center', marginTop: '20px' }}>
                        <p style={{ fontSize: '9px', letterSpacing: '2px', color: '#252530', textTransform: 'uppercase' }}>Premium Ebook Studio</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PremiumEbookStudio />);
    </script>
</body>
</html>
